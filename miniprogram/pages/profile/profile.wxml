<view class="profile-container">
  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="user-card">
    <view class="user-avatar">
      <image wx:if="{{avatarUrl}}" class="avatar-image" src="{{avatarUrl}}" mode="aspectFill" binderror="onAvatarError" bindload="onAvatarLoad"></image>
      <view wx:else class="avatar-placeholder">
        <text class="avatar-text">{{userInfo.name ? userInfo.name.charAt(0) : 'U'}}</text>
      </view>
    </view>
    <view class="user-info">
      <text class="user-name">{{userInfo.name}}</text>
      <text class="user-phone">{{userInfo.phone}}</text>
      <text class="user-department">{{userInfo.department ? userInfo.department.name : 'æœªåˆ†é…éƒ¨é—¨'}}</text>
    </view>
  </view>



  <!-- åŠŸèƒ½èœå• -->
  <view class="menu-section">
    <view class="menu-group">
      <!-- ç®¡ç†å‘˜åŠŸèƒ½ï¼šéƒ¨é—¨ç®¡ç† -->
      <view class="menu-item" bindtap="goToDepartmentManagement" wx:if="{{userInfo.role === 'admin'}}">
        <view class="menu-icon department-icon">
          <text class="icon-text">ğŸ¢</text>
        </view>
        <view class="menu-content">
          <text class="menu-title">éƒ¨é—¨ç®¡ç†</text>
          <text class="menu-subtitle">ç®¡ç†éƒ¨é—¨è®¾ç½®</text>
        </view>
        <view class="menu-arrow">
          <text class="arrow-text">â€º</text>
        </view>
      </view>
      
      <!-- ä¿®æ”¹äººè„¸ -->
      <view class="menu-item" bindtap="showFaceUpdateDialog">
        <view class="menu-icon face-icon">
          <text class="icon-text">ğŸ‘¤</text>
        </view>
        <view class="menu-content">
          <text class="menu-title">ä¿®æ”¹äººè„¸</text>
          <text class="menu-subtitle">æ›´æ–°äººè„¸è¯†åˆ«ç…§ç‰‡</text>
        </view>
        <view class="menu-arrow">
          <text class="arrow-text">â€º</text>
        </view>
      </view>
      
      <view class="menu-item" bindtap="goToSettings">
        <view class="menu-icon settings-icon">
          <text class="icon-text">âš™ï¸</text>
        </view>
        <view class="menu-content">
          <text class="menu-title">è®¾ç½®</text>
          <text class="menu-subtitle">åº”ç”¨è®¾ç½®</text>
        </view>
        <view class="menu-arrow">
          <text class="arrow-text">â€º</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ä»Šæ—¥è€ƒå‹¤çŠ¶æ€ -->
  <view class="today-status-section">
    <view class="section-header">
      <text class="section-title">ä»Šæ—¥è€ƒå‹¤</text>
    </view>
    <view class="status-content">
      <view class="status-item" wx:if="{{todayStatus.sign_in}}">
        <view class="status-icon signin-icon">
          <text class="icon-text">âœ“</text>
        </view>
        <view class="status-info">
          <text class="status-label">ç­¾åˆ°æ—¶é—´</text>
          <text class="status-time">{{todayStatus.sign_in}}</text>
        </view>
        <view class="status-badge {{todayStatus.sign_in_status}}">
          <text class="badge-text">{{getStatusText(todayStatus.sign_in_status)}}</text>
        </view>
      </view>
      
      <view class="status-item" wx:if="{{todayStatus.sign_out}}">
        <view class="status-icon signout-icon">
          <text class="icon-text">â†©</text>
        </view>
        <view class="status-info">
          <text class="status-label">ç­¾é€€æ—¶é—´</text>
          <text class="status-time">{{todayStatus.sign_out}}</text>
        </view>
        <view class="status-badge {{todayStatus.sign_out_status}}">
          <text class="badge-text">{{getStatusText(todayStatus.sign_out_status)}}</text>
        </view>
      </view>
      
      <view class="status-item" wx:if="{{!todayStatus.sign_in && !todayStatus.sign_out}}">
        <view class="status-icon absent-icon">
          <text class="icon-text">âœ—</text>
        </view>
        <view class="status-info">
          <text class="status-label">ä»Šæ—¥çŠ¶æ€</text>
          <text class="status-time">æœªæ‰“å¡</text>
        </view>
        <view class="status-badge absent">
          <text class="badge-text">ç¼ºå‹¤</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å¿«æ·æ“ä½œ -->
  <view class="quick-actions">
    <view class="action-item" bindtap="goToAttendance">
      <view class="action-icon">
        <text class="icon-text">ğŸ“±</text>
      </view>
      <text class="action-text">å»æ‰“å¡</text>
    </view>
    
    <view class="action-item" bindtap="goToCalendar">
      <view class="action-icon">
        <text class="icon-text">ğŸ“…</text>
      </view>
      <text class="action-text">è€ƒå‹¤æ—¥å†</text>
    </view>
    

  </view>

  <!-- äººè„¸æ›´æ–°ç”³è¯·çŠ¶æ€ -->
  <view class="face-request-status" wx:if="{{faceRequestStatus.has_request}}">
    <view class="section-header">
      <text class="section-title">äººè„¸æ›´æ–°ç”³è¯·</text>
    </view>
    <view class="request-card">
      <view class="request-info">
        <view class="request-status {{faceRequestStatus.request.status}}">
          <text class="status-text">{{faceRequestStatus.request.status_text}}</text>
        </view>
        <view class="request-details">
          <text class="request-reason">ç”³è¯·åŸå› ï¼š{{faceRequestStatus.request.reason}}</text>
          <text class="request-time">ç”³è¯·æ—¶é—´ï¼š{{faceRequestStatus.request.created_at}}</text>
          <text class="admin-comment" wx:if="{{faceRequestStatus.request.admin_comment}}">
            ç®¡ç†å‘˜å¤‡æ³¨ï¼š{{faceRequestStatus.request.admin_comment}}
          </text>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œ -->
  <view class="bottom-actions">
    <button class="logout-btn" bindtap="logout">
      <text class="btn-text">é€€å‡ºç™»å½•</text>
    </button>
  </view>
</view>

<!-- äººè„¸æ›´æ–°å¼¹çª— -->
<view class="face-update-modal" wx:if="{{showFaceUpdateModal}}">
  <view class="modal-overlay" bindtap="hideFaceUpdateDialog"></view>
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">ç”³è¯·ä¿®æ”¹äººè„¸</text>
      <view class="modal-close" bindtap="hideFaceUpdateDialog">
        <text class="close-text">âœ•</text>
      </view>
    </view>
    
    <view class="modal-body">
      <!-- ç…§ç‰‡ä¸Šä¼ åŒºåŸŸ -->
      <view class="upload-section">
        <text class="upload-label">ä¸Šä¼ æ–°çš„äººè„¸ç…§ç‰‡ (æœ€å¤š5å¼ )</text>
        
        <!-- å›¾ç‰‡é¢„è§ˆåˆ—è¡¨ -->
        <view wx:if="{{faceUpdateForm.images.length > 0}}" class="images-preview">
          <view class="preview-grid">
            <view 
              wx:for="{{faceUpdateForm.images}}" 
              wx:key="id" 
              class="preview-item"
            >
              <image class="preview-image" src="{{item.displayUrl}}" mode="aspectFill"></image>
              <view class="remove-btn" bindtap="removeImage" data-id="{{item.id}}">
                <text class="remove-text">Ã—</text>
              </view>
            </view>
          </view>
          <view class="image-count">å·²é€‰æ‹© {{faceUpdateForm.images.length}}/5 å¼ ç…§ç‰‡</view>
        </view>
        
        <!-- ä¸Šä¼ æŒ‰é’® -->
        <view 
          class="upload-area {{faceUpdateForm.images.length >= 5 ? 'disabled' : ''}}" 
          bindtap="chooseImage"
        >
          <view class="upload-placeholder">
            <text class="upload-text">ğŸ“·</text>
            <text class="upload-hint">
              {{faceUpdateForm.images.length >= 5 ? 'å·²è¾¾æœ€å¤§æ•°é‡' : 
                faceUpdateForm.images.length > 0 ? 'ç»§ç»­æ·»åŠ ç…§ç‰‡' : 'ç‚¹å‡»ä¸Šä¼ ç…§ç‰‡'}}
            </text>
          </view>
        </view>
      </view>
      
      <!-- ç”³è¯·åŸå›  -->
      <view class="reason-section">
        <text class="reason-label">ç”³è¯·åŸå› </text>
        <textarea 
          class="reason-input" 
          placeholder="è¯·ç®€è¿°ä¿®æ”¹äººè„¸çš„åŸå› ..." 
          value="{{faceUpdateForm.reason}}"
          bindinput="onReasonInput"
          maxlength="200"
        ></textarea>
        <text class="char-count">{{faceUpdateForm.reason.length}}/200</text>
      </view>
    </view>
    
    <view class="modal-footer">
      <button class="cancel-btn" bindtap="hideFaceUpdateDialog">å–æ¶ˆ</button>
      <button 
        class="submit-btn" 
        bindtap="submitFaceUpdateRequest"
        disabled="{{!canSubmit || submitting}}"
      >
        {{submitting ? 'æäº¤ä¸­...' : 'æäº¤ç”³è¯·'}}
      </button>
    </view>
  </view>
</view> 
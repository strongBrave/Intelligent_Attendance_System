<view class="calendar-container">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="header">
    <view class="month-selector">
      <view class="arrow" bindtap="prevMonth">
        <text class="arrow-text">â€¹</text>
      </view>
      <view class="current-month">
        <text class="month-text">{{currentYear}}å¹´{{currentMonth}}æœˆ</text>
      </view>
      <view class="arrow" bindtap="nextMonth">
        <text class="arrow-text">â€º</text>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-cards">
    <view class="stat-card">
      <view class="stat-icon normal-in">
        <text class="icon">ğŸ“¥</text>
      </view>
      <view class="stat-content">
        <text class="stat-number">{{stats.normal_sign_in}}</text>
        <text class="stat-label">æ­£å¸¸ç­¾åˆ°</text>
      </view>
    </view>
    <view class="stat-card">
      <view class="stat-icon normal-out">
        <text class="icon">ğŸ“¤</text>
      </view>
      <view class="stat-content">
        <text class="stat-number">{{stats.normal_sign_out}}</text>
        <text class="stat-label">æ­£å¸¸ç­¾é€€</text>
      </view>
    </view>
    <view class="stat-card">
      <view class="stat-icon late">
        <text class="icon">â°</text>
      </view>
      <view class="stat-content">
        <text class="stat-number">{{stats.late}}</text>
        <text class="stat-label">è¿Ÿåˆ°</text>
      </view>
    </view>
    <view class="stat-card">
      <view class="stat-icon absent">
        <text class="icon">âœ—</text>
      </view>
      <view class="stat-content">
        <text class="stat-number">{{stats.absent}}</text>
        <text class="stat-label">ç¼ºå‹¤</text>
      </view>
    </view>
    <view class="stat-card">
      <view class="stat-icon early">
        <text class="icon">â†©</text>
      </view>
      <view class="stat-content">
        <text class="stat-number">{{stats.early_leave}}</text>
        <text class="stat-label">æ—©é€€</text>
      </view>
    </view>
    <view class="stat-card" wx:if="{{stats.late_leave > 0}}">
      <view class="stat-icon late-leave">
        <text class="icon">ğŸŒ™</text>
      </view>
      <view class="stat-content">
        <text class="stat-number">{{stats.late_leave}}</text>
        <text class="stat-label">æ™šé€€</text>
      </view>
    </view>
  </view>

  <!-- æ˜ŸæœŸæ ‡é¢˜ -->
  <view class="weekdays">
    <view class="weekday" wx:for="{{weekdays}}" wx:key="*this">
      <text class="weekday-text">{{item}}</text>
    </view>
  </view>

  <!-- æ—¥å†ç½‘æ ¼ -->
  <view class="calendar-grid">
    <view 
      class="calendar-day {{item.isCurrentMonth ? '' : 'other-month'}} {{item.isToday ? 'today' : ''}} {{item.attendance ? 'has-attendance' : ''}}"
      wx:for="{{calendarDays}}" 
      wx:key="date"
      bindtap="selectDate"
      data-date="{{item.date}}"
    >
      <view class="day-number">{{item.day}}</view>
      <view class="attendance-status" wx:if="{{item.attendance}}">
        <view class="status-dot {{item.attendance.status}}"></view>
        <view class="attendance-times" wx:if="{{item.attendance.sign_in || item.attendance.sign_out}}">
          <text class="time-text" wx:if="{{item.attendance.sign_in}}">{{item.attendance.sign_in.time}}</text>
          <text class="time-text" wx:if="{{item.attendance.sign_out}}">{{item.attendance.sign_out.time}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- é€‰ä¸­æ—¥æœŸè¯¦æƒ… -->
  <view class="date-detail" wx:if="{{selectedDate}}">
    <view class="detail-header">
      <text class="detail-title">{{selectedDate}} è€ƒå‹¤è¯¦æƒ…</text>
    </view>
    
    <view class="detail-content">
      <!-- ç­¾åˆ°ä¿¡æ¯ -->
      <view class="attendance-section">
        <view class="section-header">
          <text class="section-icon">ğŸ“¥</text>
          <text class="section-title">ç­¾åˆ°ä¿¡æ¯</text>
        </view>
        <view class="section-content">
          <view class="detail-item">
            <view class="detail-label">
              <text class="label-text">ç­¾åˆ°æ—¶é—´</text>
            </view>
            <view class="detail-value">
              <text class="value-text" wx:if="{{selectedAttendance.sign_in}}">{{selectedAttendance.sign_in.time}}</text>
              <text class="value-text no-data" wx:else>æœªç­¾åˆ°</text>
            </view>
          </view>
          <view class="detail-item">
            <view class="detail-label">
              <text class="label-text">ç­¾åˆ°çŠ¶æ€</text>
            </view>
            <view class="detail-value">
              <text class="value-text {{selectedAttendance.sign_in.status}}" wx:if="{{selectedAttendance.sign_in}}">{{selectedAttendance.sign_in.statusText}}</text>
              <text class="value-text no-data" wx:else>æ— çŠ¶æ€</text>
            </view>
          </view>
          <view class="detail-item">
            <view class="detail-label">
              <text class="label-text">ç­¾åˆ°ä½ç½®</text>
            </view>
            <view class="detail-value">
              <text class="value-text location" wx:if="{{selectedAttendance.sign_in && selectedAttendance.sign_in.location}}">{{selectedAttendance.sign_in.location}}</text>
              <text class="value-text no-data" wx:else>æ— ä½ç½®ä¿¡æ¯</text>
            </view>
          </view>
        </view>
      </view>

      <!-- ç­¾é€€ä¿¡æ¯ -->
      <view class="attendance-section">
        <view class="section-header">
          <text class="section-icon">ğŸ“¤</text>
          <text class="section-title">ç­¾é€€ä¿¡æ¯</text>
        </view>
        <view class="section-content">
          <view class="detail-item">
            <view class="detail-label">
              <text class="label-text">ç­¾é€€æ—¶é—´</text>
            </view>
            <view class="detail-value">
              <text class="value-text" wx:if="{{selectedAttendance.sign_out}}">{{selectedAttendance.sign_out.time}}</text>
              <text class="value-text no-data" wx:else>æœªç­¾é€€</text>
            </view>
          </view>
          <view class="detail-item">
            <view class="detail-label">
              <text class="label-text">ç­¾é€€çŠ¶æ€</text>
            </view>
            <view class="detail-value">
              <text class="value-text {{selectedAttendance.sign_out.status}}" wx:if="{{selectedAttendance.sign_out}}">{{selectedAttendance.sign_out.statusText}}</text>
              <text class="value-text no-data" wx:else>æ— çŠ¶æ€</text>
            </view>
          </view>
          <view class="detail-item">
            <view class="detail-label">
              <text class="label-text">ç­¾é€€ä½ç½®</text>
            </view>
            <view class="detail-value">
              <text class="value-text location" wx:if="{{selectedAttendance.sign_out && selectedAttendance.sign_out.location}}">{{selectedAttendance.sign_out.location}}</text>
              <text class="value-text no-data" wx:else>æ— ä½ç½®ä¿¡æ¯</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œ -->
  <view class="bottom-actions">
    <button class="action-btn" bindtap="goToAttendance">
      <text class="btn-text">å»æ‰“å¡</text>
    </button>
    <button class="action-btn secondary" bindtap="refreshData">
      <text class="btn-text">åˆ·æ–°</text>
    </button>
  </view>
</view> 
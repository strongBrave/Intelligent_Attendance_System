<view class="department-container">
  <!-- é¡¶éƒ¨æ“ä½œæ  -->
  <view class="header">
    <text class="title">éƒ¨é—¨ç®¡ç†</text>
    <button class="add-btn" bindtap="showAddDialog">æ–°å¢éƒ¨é—¨</button>
  </view>

  <!-- éƒ¨é—¨åˆ—è¡¨ -->
  <view class="department-list">
    <view class="department-item" wx:for="{{departments}}" wx:key="id">
      <view class="dept-info">
        <view class="dept-name">{{item.name}}</view>
        <view class="dept-details">
          <text class="detail-item">ç­¾åˆ°: {{item.sign_in_time}}</text>
          <text class="detail-item">ç­¾é€€: {{item.sign_out_time}}</text>
          <text class="detail-item">å‘˜å·¥: {{item.user_count}}äºº</text>
        </view>
        <view class="dept-location" wx:if="{{item.location}}">
          <text class="location-text">ğŸ“ {{item.location}}</text>
        </view>
      </view>
      <view class="dept-actions">
        <button class="action-btn edit" bindtap="editDepartment" data-dept="{{item}}">ç¼–è¾‘</button>
        <button class="action-btn delete" bindtap="deleteDepartment" data-dept="{{item}}" wx:if="{{item.user_count === 0}}">åˆ é™¤</button>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{departments.length === 0 && !loading}}">
    <text class="empty-text">æš‚æ— éƒ¨é—¨æ•°æ®</text>
  </view>

  <!-- æ–°å¢/ç¼–è¾‘éƒ¨é—¨å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showModal}}" bindtap="hideModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">{{isEdit ? 'ç¼–è¾‘éƒ¨é—¨' : 'æ–°å¢éƒ¨é—¨'}}</text>
        <text class="modal-close" bindtap="hideModal">Ã—</text>
      </view>

      <form class="form" bindsubmit="submitForm">
        <!-- éƒ¨é—¨åç§° -->
        <view class="form-item">
          <text class="form-label">éƒ¨é—¨åç§°</text>
          <input class="form-input" name="name" value="{{form.name}}" placeholder="è¯·è¾“å…¥éƒ¨é—¨åç§°" maxlength="50" />
        </view>

        <!-- ç­¾åˆ°æ—¶é—´ -->
        <view class="form-item">
          <text class="form-label">ç­¾åˆ°æ—¶é—´</text>
          <picker mode="time" name="sign_in_time" value="{{form.sign_in_time}}" bindchange="onTimeChange" data-type="sign_in_time">
            <view class="picker-input">
              <text class="picker-text">{{form.sign_in_time}}</text>
              <text class="picker-arrow">â–¼</text>
            </view>
          </picker>
        </view>

        <!-- ç­¾é€€æ—¶é—´ -->
        <view class="form-item">
          <text class="form-label">ç­¾é€€æ—¶é—´</text>
          <picker mode="time" name="sign_out_time" value="{{form.sign_out_time}}" bindchange="onTimeChange" data-type="sign_out_time">
            <view class="picker-input">
              <text class="picker-text">{{form.sign_out_time}}</text>
              <text class="picker-arrow">â–¼</text>
            </view>
          </picker>
        </view>

        <!-- è¿Ÿåˆ°é˜ˆå€¼ -->
        <view class="form-item">
          <text class="form-label">è¿Ÿåˆ°é˜ˆå€¼</text>
          <picker mode="time" name="late_threshold" value="{{form.late_threshold}}" bindchange="onTimeChange" data-type="late_threshold">
            <view class="picker-input">
              <text class="picker-text">{{form.late_threshold}}</text>
              <text class="picker-arrow">â–¼</text>
            </view>
          </picker>
        </view>

        <!-- ç¼ºå‹¤é˜ˆå€¼ -->
        <view class="form-item">
          <text class="form-label">ç¼ºå‹¤é˜ˆå€¼</text>
          <picker mode="time" name="absent_threshold" value="{{form.absent_threshold}}" bindchange="onTimeChange" data-type="absent_threshold">
            <view class="picker-input">
              <text class="picker-text">{{form.absent_threshold}}</text>
              <text class="picker-arrow">â–¼</text>
            </view>
          </picker>
        </view>

        <!-- æ—©é€€é˜ˆå€¼ -->
        <view class="form-item">
          <text class="form-label">æ—©é€€é˜ˆå€¼</text>
          <picker mode="time" name="early_leave_threshold" value="{{form.early_leave_threshold}}" bindchange="onTimeChange" data-type="early_leave_threshold">
            <view class="picker-input">
              <text class="picker-text">{{form.early_leave_threshold}}</text>
              <text class="picker-arrow">â–¼</text>
            </view>
          </picker>
        </view>

        <!-- æ‰“å¡ä½ç½® -->
        <view class="form-item">
          <text class="form-label">æ‰“å¡ä½ç½®</text>
          <view class="location-input">
            <input class="form-input" value="{{form.location}}" placeholder="è¯·é€‰æ‹©æ‰“å¡ä½ç½®" disabled />
            <button class="location-btn" bindtap="chooseLocation" type="button">åœ°å›¾é€‰ç‚¹</button>
          </view>
          <view class="location-preview" wx:if="{{form.location}}">
            <text class="location-text">ğŸ“ {{form.location}}</text>
          </view>
        </view>

        <!-- è¡¨å•æŒ‰é’® -->
        <view class="form-actions">
          <button class="form-btn cancel" bindtap="hideModal" type="button">å–æ¶ˆ</button>
          <button class="form-btn submit" formType="submit" loading="{{submitting}}">
            {{isEdit ? 'æ›´æ–°' : 'æ·»åŠ '}}
          </button>
        </view>
      </form>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view> 